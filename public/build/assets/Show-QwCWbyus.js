import{_ as q}from"./AuthenticatedLayout-BJ3GHpWI.js";import{O as D,f as k,r as h,I as g,o as d,w as B,b as s,a as i,t as l,u as r,c as u,d as m,F as S,i as A,W as I}from"./app-F58_UoWD.js";import{a as y}from"./index-CC6mfoPh.js";import{s as F}from"./index-UZ0yj1gR.js";import{s as O,a as T}from"./index-oBDDfzU3.js";import{s as W}from"./index-DkO7Kdvj.js";import{s as E}from"./index-gHhajIzV.js";import{s as b}from"./index-CmUnhNvR.js";import"./index-DAI752ND.js";import"./index-BRzZe2lv.js";import"./index-BZDxK1Md.js";import"./index-4IM0nGPT.js";import"./index-DaThi7rv.js";import"./index-B5aQQnwt.js";import"./index-DLidApoh.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./FavIcons-CQZLfX3A.js";import"./index-DQuQH5Eq.js";import"./index-wIKaeBs8.js";import"./index-BPEvPgvo.js";const z={class:"max-w-5xl mx-auto p-6 space-y-6"},G={class:"flex justify-between items-start gap-3"},H={class:"text-2xl font-bold"},J={class:"text-sm text-gray-500"},K={class:"flex gap-2 flex-wrap"},Q={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},R={class:"border rounded-lg p-4"},X={class:"font-semibold"},Y={key:0,class:"text-xs"},Z={class:"border rounded-lg p-4"},ee={class:"text-red-600"},te={class:"border rounded-lg p-4 space-y-2"},se={class:"border rounded-lg"},oe={class:"font-medium"},ae={class:"text-xs text-gray-500"},ne={class:"font-semibold"},le={class:"border rounded-lg"},re={class:"flex justify-between"},de={class:"font-medium"},ie={class:"font-semibold"},ue={key:0,class:"text-xs text-gray-500"},me={key:1,class:"mt-1 text-xs text-gray-600"},ce={key:0},ve={key:1},fe={key:2},pe={class:"space-y-3"},ye={key:0,class:"border rounded p-3 bg-slate-50"},_e={class:"flex justify-end gap-2 pt-2"},Le={__name:"Show",props:{order:Object,paymentMethods:Array},setup(a){const _=D(),c=a,v=n=>Number(n||0).toFixed(2),w=k(()=>{var n;return(n=c.order.payments)==null?void 0:n.reduce((e,f)=>e+Number(f.amount||0),0)}),V=k(()=>Math.max(0,Number(c.order.total_amount||0)-w.value)),U=k(()=>c.order.status!=="void"&&V.value>0);function M(n){return n==="paid"?"success":n==="partial"?"warn":"danger"}function N(n){return n==="completed"?"success":n==="draft"?"info":"danger"}const p=h(!1),x=h(!1),o=h({payment_method_id:null,amount:0,transaction_ref:"",notes:"",meta:{customer_bank_name:"",customer_account_no:"",received_to_bank_account_id:null,txn_ref:""}});function C(){var e;const n=c.paymentMethods.find(f=>f.id===o.value.payment_method_id);return(e=n==null?void 0:n.name)==null?void 0:e.toLowerCase().includes("bank")}function j(){if(!o.value.payment_method_id||o.value.amount<=0){_.add({severity:"warn",summary:"Invalid payment",detail:"Select method and amount",life:2500});return}if(C()&&(!o.value.meta.customer_bank_name||!o.value.meta.customer_account_no)){_.add({severity:"warn",summary:"Bank info required",detail:"Customer bank name & account no required",life:3e3});return}x.value=!0,I.post(route("pos.orders.payments.store",c.order.id),o.value,{preserveScroll:!0,onSuccess:()=>{_.add({severity:"success",summary:"Payment added",detail:"Order updated successfully",life:2200}),p.value=!1},onFinish:()=>x.value=!1})}function L(){confirm("Are you sure you want to VOID this order?")&&I.post(route("pos.orders.void",c.order.id),{},{onSuccess:()=>{_.add({severity:"success",summary:"Voided",detail:"Order has been voided",life:2200})}})}return(n,e)=>(d(),g(q,null,{default:B(()=>{var f,P;return[s("div",z,[s("div",G,[s("div",null,[s("h2",H," Invoice "+l(a.order.invoice_no||`#${a.order.id}`),1),s("p",J,l(new Date(a.order.created_at).toLocaleString()),1)]),s("div",K,[i(r(O),{value:a.order.payment_status,severity:M(a.order.payment_status)},null,8,["value","severity"]),i(r(O),{value:a.order.status,severity:N(a.order.status)},null,8,["value","severity"])])]),s("div",Q,[s("div",R,[e[10]||(e[10]=s("div",{class:"text-xs text-gray-500"},"Customer",-1)),s("div",X,l(((f=a.order.customer)==null?void 0:f.name)||"Walk-in"),1),(P=a.order.customer)!=null&&P.phone?(d(),u("div",Y,l(a.order.customer.phone),1)):m("",!0)]),s("div",Z,[e[11]||(e[11]=s("div",{class:"text-xs text-gray-500"},"Totals",-1)),s("div",null,"Total: "+l(v(a.order.total_amount)),1),s("div",null,"Paid: "+l(v(w.value)),1),s("div",ee,"Due: "+l(v(V.value)),1)]),s("div",te,[i(r(y),{label:"Print Invoice",icon:"pi pi-print",class:"w-full",onClick:e[0]||(e[0]=t=>n.window.open(n.route("pos.orders.invoice",a.order.id)+"?autoprint=1","_blank"))}),U.value?(d(),g(r(y),{key:0,label:"Add Payment",icon:"pi pi-plus",class:"w-full p-button-success",onClick:e[1]||(e[1]=t=>p.value=!0)})):m("",!0),a.order.status!=="void"?(d(),g(r(y),{key:1,label:"Void Order",icon:"pi pi-ban",class:"w-full p-button-danger",onClick:L})):m("",!0)])]),s("div",se,[e[12]||(e[12]=s("div",{class:"p-3 font-semibold"},"Items",-1)),i(r(T)),(d(!0),u(S,null,A(a.order.items,t=>(d(),u("div",{key:t.id,class:"flex justify-between px-4 py-2 text-sm"},[s("div",null,[s("div",oe,l(t.name),1),s("div",ae,l(t.quantity)+" Ã— "+l(v(t.unit_price)),1)]),s("div",ne,l(v(t.line_total)),1)]))),128))]),s("div",le,[e[13]||(e[13]=s("div",{class:"p-3 font-semibold"},"Payments",-1)),i(r(T)),(d(!0),u(S,null,A(a.order.payments,t=>{var $;return d(),u("div",{key:t.id,class:"px-4 py-3 border-b last:border-b-0 text-sm"},[s("div",re,[s("span",de,l(($=t.payment_method)==null?void 0:$.name),1),s("span",ie,l(v(t.amount)),1)]),t.transaction_ref?(d(),u("div",ue," Txn: "+l(t.transaction_ref),1)):m("",!0),t.meta?(d(),u("div",me,[t.meta.customer_bank_name?(d(),u("div",ce," Bank: "+l(t.meta.customer_bank_name),1)):m("",!0),t.meta.customer_account_no?(d(),u("div",ve," A/C: "+l(t.meta.customer_account_no),1)):m("",!0),t.meta.txn_ref?(d(),u("div",fe," Bank Txn: "+l(t.meta.txn_ref),1)):m("",!0)])):m("",!0)])}),128))])]),i(r(F),{visible:p.value,"onUpdate:visible":e[9]||(e[9]=t=>p.value=t),modal:"",header:"Add Payment",style:{width:"520px"}},{default:B(()=>[s("div",pe,[i(r(W),{modelValue:o.value.payment_method_id,"onUpdate:modelValue":e[2]||(e[2]=t=>o.value.payment_method_id=t),options:a.paymentMethods,optionLabel:"name",optionValue:"id",placeholder:"Payment method",class:"w-full"},null,8,["modelValue","options"]),i(r(E),{modelValue:o.value.amount,"onUpdate:modelValue":e[3]||(e[3]=t=>o.value.amount=t),min:0,class:"w-full",inputClass:"w-full",placeholder:"Amount"},null,8,["modelValue"]),i(r(b),{modelValue:o.value.transaction_ref,"onUpdate:modelValue":e[4]||(e[4]=t=>o.value.transaction_ref=t),placeholder:"Transaction ref",class:"w-full"},null,8,["modelValue"]),C()?(d(),u("div",ye,[e[14]||(e[14]=s("div",{class:"font-semibold text-sm mb-2"},"Bank Info",-1)),i(r(b),{modelValue:o.value.meta.customer_bank_name,"onUpdate:modelValue":e[5]||(e[5]=t=>o.value.meta.customer_bank_name=t),placeholder:"Customer bank name",class:"w-full mb-2"},null,8,["modelValue"]),i(r(b),{modelValue:o.value.meta.customer_account_no,"onUpdate:modelValue":e[6]||(e[6]=t=>o.value.meta.customer_account_no=t),placeholder:"Customer account no",class:"w-full mb-2"},null,8,["modelValue"]),i(r(b),{modelValue:o.value.meta.txn_ref,"onUpdate:modelValue":e[7]||(e[7]=t=>o.value.meta.txn_ref=t),placeholder:"Bank txn / cheque no",class:"w-full"},null,8,["modelValue"])])):m("",!0),s("div",_e,[i(r(y),{label:"Cancel",class:"p-button-text",onClick:e[8]||(e[8]=t=>p.value=!1)}),i(r(y),{label:"Save Payment",icon:"pi pi-check",class:"p-button-success",loading:x.value,onClick:j},null,8,["loading"])])])]),_:1},8,["visible"])]}),_:1}))}};export{Le as default};
